<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Object Passport - STEM Learn Odisha</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f0f7ff;
            color: #1e293b;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, #0e2a47 0%, #1a365d 100%);
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo i {
            font-size: 1.8rem;
            color: #2a69ac;
        }

        .logo-text h1 {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-text h1 span {
            color: #38b2ac;
            font-weight: 800;
        }

        .logo-text p {
            font-size: 0.8rem;
            opacity: 0.9;
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 30px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 6px;
        }

        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Horizontal Language Selector */
        .language-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 15px;
        }

        .language-option-btn {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 60px;
            text-align: center;
        }

        .language-option-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .language-option-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.6);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-size: 1rem;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .profile-container {
            position: relative;
        }

        .profile-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 30px;
            padding: 8px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .profile-pic {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
        }

        .profile-dropdown {
            position: absolute;
            top: 55px;
            right: 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            width: 180px;
            display: none;
            z-index: 1001;
            overflow: hidden;
        }

        .profile-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            text-decoration: none;
            transition: all 0.3s ease;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f5f7fa;
        }

        .dropdown-item i {
            color: #3182ce;
            width: 20px;
        }

        /* Remove old language options */
        .language-options {
            display: none !important;
        }

        /* Instructions Modal */
        .instructions-modal { display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.85); z-index: 2000; align-items: center; justify-content: center; }
        .instructions-content { background: white; border-radius: 20px; width: 90%; max-width: 700px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); position: relative; text-align: center; }
        .instructions-title { font-size: 2rem; margin-bottom: 20px; color: #1a365d; font-weight: 700; }
        .instructions-text { color: #64748b; margin-bottom: 25px; line-height: 1.6; text-align: left; font-size: 1.1rem; }
        .instructions-list { margin-left: 20px; margin-bottom: 25px; }
        .instructions-list li { margin-bottom: 10px; }
        .start-game-btn { padding: 15px 40px; background: linear-gradient(135deg, #38b2ac 0%, #2c9a94 100%); color: white; border: none; border-radius: 10px; font-size: 1.2rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 20px; }
        .start-game-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(56, 178, 172, 0.3); }

        /* Game Header */
        .game-header {
            background: linear-gradient(rgba(14, 42, 71, 0.85), rgba(26, 54, 93, 0.9)), url('https://images.unsplash.com/photo-1542744095-291d1f67b221?crop=entropy&cs=tinysrgb&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 60px 0;
            text-align: center;
            position: relative;
        }

        .game-header h1 {
            font-size: 2.8rem;
            margin-bottom: 20px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .game-header p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
            opacity: 0.95;
            font-weight: 300;
        }

        /* Game Stats */
        .game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 1000px;
        }

        .timer {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a365d;
        }

        .timer i {
            color: #e53e3e;
        }

        .score {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a365d;
        }

        .score i {
            color: #38a169;
        }

        .hints {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a365d;
        }

        .hints i {
            color: #d69e2e;
        }

        .progress-container {
            width: 200px;
            height: 12px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #3182ce;
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        /* Game Area */
        .game-area {
            padding: 20px 0 60px;
        }

        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 26px;
            max-width: 1000px;
            margin: 0 auto;
            align-items: start;
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            padding: 20px;
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.06);
            position: relative;
            min-height: 420px; /* Same height for both boxes */
            display: flex;
            flex-direction: column;
        }

        /* Left object preview - SAME DIMENSIONS AS PASSPORT */
        .object-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .object-emoji {
            font-size: 5.2rem;
            background: linear-gradient(145deg, #ffffff, #f1f8ff);
            width: 140px;
            height: 140px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.06);
        }

        .object-name {
            font-weight: 800;
            font-size: 1.2rem;
            color: #1a365d;
            text-align: center;
        }

        .object-desc {
            color: #4a5568;
            font-size: .95rem;
            text-align: center;
            padding: 6px 10px;
        }

        /* Passport card (right) */
        .passport-card {
            background: linear-gradient(145deg, #ffffff, #f7fbff);
            padding: 18px;
            border-radius: 18px;
            border: 3px solid rgba(66, 153, 225, 0.06);
        }

        .passport-title {
            font-weight: 800;
            font-size: 1.2rem;
            color: #1a365d;
            margin-bottom: 10px;
            text-align: center;
        }

        .passport-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .form-row {
            display: flex;
            flex-direction: column;
            gap: 6px;
            width: 100%;
        }

        label {
            font-size: .85rem;
            color: #475569;
            font-weight: 600;
        }

        select {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #cbd5e1;
            background: #fff;
            font-weight: 600;
            width: 100%;
            min-width: 0; /* Prevent flexbox overflow */
        }

        /* Ensure all select boxes have the same width */
        .passport-form .form-row:nth-child(odd) select,
        .passport-form .form-row:nth-child(even) select {
            width: 100%;
        }

        .verify-btn {
            margin-top: 14px;
            padding: 12px 16px;
            background: linear-gradient(45deg, #38b2ac, #2c9a94);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            grid-column: 1 / -1; /* Span both columns */
        }

        .verify-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(56, 178, 172, 0.3);
        }

        .retry-btn {
            margin-top: 14px;
            padding: 12px 16px;
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: #fff;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            display: none;
            grid-column: 1 / -1; /* Span both columns */
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(229, 62, 62, 0.3);
        }

        /* Stamp overlay (big) */
        .passport-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            z-index: 2200;
        }

        .passport-card-large {
            width: 82%;
            max-width: 760px;
            background: #fff;
            border-radius: 14px;
            padding: 22px;
            box-shadow: 0 30px 80px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 20px;
            transform: translateY(20px);
            opacity: 0;
            transition: all .45s;
        }

        .passport-card-large.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .passport-large-left {
            flex: 0 0 120px;
            text-align: center;
        }

        .passport-large-center {
            flex: 1;
        }

        .passport-stamp {
            width: 220px;
            height: 220px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 2.6rem;
            color: #fff;
            transform: rotate(-18deg) scale(.8);
            opacity: 0;
            transition: all .45s;
        }

        .passport-stamp.approved {
            background: #16a34a;
            box-shadow: 0 12px 40px rgba(22, 163, 74, 0.28);
        }

        .passport-stamp.rejected {
            background: #ef4444;
            box-shadow: 0 12px 40px rgba(239, 68, 68, 0.28);
        }

        .passport-stamp.show {
            opacity: 1;
            transform: rotate(-18deg) scale(1.05);
        }

        /* Level Complete with Ranking */
        .level-complete { display:none; text-align:center; padding:28px; background:linear-gradient(145deg,#ffffff,#f7fafc); border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.08); max-width:700px; margin:24px auto; }
        .level-complete .badge { font-size: 3rem; margin-bottom: 20px; color: #fbbf24; }
        .level-complete .badge i { font-size: 3.5rem; }
        .level-title { font-size:2.2rem; font-weight:800; color:#1a365d; margin-bottom:15px; }
        .level-text { color:#4a5568; margin-bottom:20px; font-size:1.1rem; line-height:1.6; }
       
        /* Score and Rank Display */
        .score-rank-container { display: flex; justify-content: center; gap: 30px; margin: 25px 0; flex-wrap: wrap; }
        .score-box, .rank-box { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.08); min-width: 180px; }
        .score-box { border-left: 5px solid #38b2ac; }
        .rank-box { border-left: 5px solid #f59e0b; }
        .score-label, .rank-label { font-size: 0.9rem; color: #64748b; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
        .score-value { font-size: 2.5rem; font-weight: 800; color: #1a365d; }
        .rank-value { font-size: 2.5rem; font-weight: 800; color: #d97706; }
        .rank-suffix { font-size: 1rem; color: #6b7280; }
       
        /* Leaderboard Preview */
        .leaderboard-preview { margin: 25px 0; padding: 20px; background: #f8fafc; border-radius: 15px; }
        .leaderboard-title { font-size: 1.2rem; font-weight: 700; color: #1e293b; margin-bottom: 15px; text-align: center; }
        .leaderboard-list { max-height: 200px; overflow-y: auto; }
        .leaderboard-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; margin-bottom: 8px; background: white; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .leaderboard-item.current-user { background: linear-gradient(135deg, #e0f2fe, #f0f9ff); border: 2px solid #0ea5e9; }
        .leaderboard-rank { font-weight: 700; color: #475569; width: 30px; text-align: center; }
        .leaderboard-name { flex-grow: 1; margin: 0 15px; font-weight: 600; }
        .leaderboard-score { font-weight: 700; color: #059669; min-width: 60px; text-align: right; }
       
        .next-level-btn { padding:12px 24px; background:linear-gradient(45deg,#38b2ac,#2c9a94); color:white; border:none; border-radius:12px; font-size:1.1rem; font-weight:800; cursor:pointer; transition: all 0.3s ease; margin-top:15px; }
        .next-level-btn:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(56, 178, 172, 0.4); }

        .particles { position:fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:-1; }
        .particle { position:absolute; width:4px; height:4px; background:rgba(255,255,255,0.5); border-radius:50%; animation: float-particle 18s infinite linear; }

        @keyframes float-particle { 0% { transform: translateY(100vh) translateX(0px); opacity:0; } 10%{opacity:1;} 90%{opacity:1;} 100%{transform:translateY(-100px) translateX(100px); opacity:0;} }

        /* Streak Counter */
        .streak-counter { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); background: linear-gradient(45deg, #ff6b6b, #ee5a24); color: white; padding: 18px 24px; border-radius: 50px; font-weight: 800; font-size: 1.2rem; box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5); z-index: 500; animation: streak-bounce 2s infinite; display: none; }
        @keyframes streak-bounce {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-55%) scale(1.1); }
        }

        /* Language-specific text styles */
        .odia-text { font-family: 'Kalinga', 'Nirmala UI', 'Segoe UI', sans-serif; font-weight:600; }
        .hindi-text { font-family: 'Nirmala UI', 'Segoe UI', sans-serif; font-weight:600; }

        /* Success Modal */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .success-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .badge {
            font-size: 3rem;
            color: #d69e2e;
            margin-bottom: 15px;
        }

        .success-title {
            font-size: 1.8rem;
            color: #1a365d;
            margin-bottom: 15px;
        }

        .success-text {
            color: #64748b;
            margin-bottom: 25px;
        }
       
        .did-you-know {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }

        .did-you-know strong {
            color: #38b2ac;
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        .did-you-know p {
            font-size: 0.95rem;
            color: #4a6572;
        }

        .next-btn {
            padding: 12px 30px;
            background: #38b2ac;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            background: #2c9a94;
            transform: translateY(-2px);
        }

        @media (max-width: 980px) {
            .game-container {
                grid-template-columns: 1fr;
                gap: 16px;
            }
           
            .passport-form {
                grid-template-columns: 1fr;
            }
           
            .object-emoji {
                width: 120px;
                height: 120px;
                font-size: 4.2rem;
            }
           
            .passport-card-large {
                width: 92%;
            }
           
            .game-stats { flex-direction:column; gap:10px; align-items:flex-start; }
            .streak-counter { display: none !important; }
            .score-rank-container { gap: 15px; }
            .score-box, .rank-box { min-width: 150px; padding: 15px; }
            .language-selector {
                margin-right: 5px;
            }
            .language-option-btn {
                padding: 4px 8px;
                font-size: 0.7rem;
                min-width: 50px;
            }
        }
       
        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }
           
            nav ul {
                gap: 15px;
            }
           
            .score-value, .rank-value { font-size: 2rem; }
            .header-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
            .language-selector {
                margin-right: 0;
                order: 1;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
        }
       
        @media (max-width: 480px) {
            .language-selector {
                gap: 5px;
            }
            .language-option-btn {
                padding: 3px 6px;
                font-size: 0.65rem;
                min-width: 45px;
            }
        }
    </style>
</head>
<body>
    <!-- Particles -->
    <div class="particles" id="particles"></div>
    <div class="streak-counter" id="streak-counter">üî• <span id="streak-count">0</span> Streak!</div>

    <!-- Header -->
    <header>
        <div class="logo-container">
            <div class="logo">
                <i class="fas fa-passport"></i>
            </div>
            <div class="logo-text">
                <h1>STEM Learn Odisha</h1>
                <p>Gamified Learning Platform</p>
            </div>
        </div>
       
        <nav>
            <ul>
                <li><a href="student-dashboard.html" id="navHome" data-translate="nav-dashboard">Dashboard</a></li>
                <li><a href="science.html" id="navScience" data-translate="nav-science">Science</a></li>
                <li><a href="about.html" id="navAbout" data-translate="nav-about">About</a></li>
                <li><a href="contact.html" id="navContact" data-translate="nav-contact">Contact</a></li>
            </ul>
        </nav>
       
        <div class="header-controls">
            <!-- Horizontal Language Selector -->
            <div class="language-selector">
                <button class="language-option-btn active" data-lang="en">English</button>
                <button class="language-option-btn" data-lang="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</button>
                <button class="language-option-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
            </div>
           
            <div class="profile-container">
                <button class="profile-btn" id="profileToggle">
                    <img src="" alt="Profile" class="profile-pic" id="headerProfilePic">
                    <span id="headerUserName">Student</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
               
                <div class="profile-dropdown" id="profileDropdown">
                    <a href="#" class="dropdown-item" id="dropdownProfile">
                        <i class="fas fa-user"></i>
                        <span data-translate="dropdown-profile">Profile</span>
                    </a>
                    <a href="#" class="dropdown-item" id="dropdownSettings">
                        <i class="fas fa-cog"></i>
                        <span data-translate="dropdown-settings">Settings</span>
                    </a>
                    <a href="#" class="dropdown-item" id="dropdownLogout">
                        <i class="fas fa-sign-out-alt"></i>
                        <span data-translate="dropdown-logout">Logout</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Instructions Modal -->
    <div class="instructions-modal" id="instructions-modal">
        <div class="instructions-content">
            <!-- Language selector for instructions -->
            <div class="language-switcher" style="position: relative; top: 0; right: 0; margin: 0 auto 20px auto; width: fit-content; background: rgba(26, 54, 93, 0.1);">
                <button class="lang-btn active" data-lang="en">English</button>
                <button class="lang-btn" data-lang="or">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü</button>
                <button class="lang-btn" data-lang="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</button>
            </div>
            
            <h2 class="instructions-title" id="instructions-title">How to Play Object Passport</h2>
            <div class="instructions-text" id="instructions-text">
                <p id="instructions-intro">Welcome to Object Passport! Help objects travel by creating their passports with the correct properties:</p>
                <ul class="instructions-list" id="instructions-list">
                    <li id="instruction-1">An object will appear on the screen with its image.</li>
                    <li id="instruction-2">Select the correct properties for the object from the options provided.</li>
                    <li id="instruction-3">Properties include shape, size, color, material, texture, and more.</li>
                    <li id="instruction-4">Click the "Verify Passport" button to check your answers.</li>
                    <li id="instruction-5">If all answers are correct, the passport gets APPROVED with a green stamp!</li>
                    <li id="instruction-6">If any answer is wrong, the passport gets REJECTED with a red stamp and you can try again.</li>
                </ul>
                <p id="instructions-outro">Help all the objects get their passports approved so they can travel!</p>
            </div>
            <button class="start-game-btn" id="start-game-btn">Start Game</button>
        </div>
    </div>

    <!-- Game Header -->
    <section class="game-header" id="game-header" style="display:none">
        <div class="container">
            <h1 data-translate="game-title">Object Passport Builder</h1>
            <p data-translate="game-desc">Identify object properties and approve passports to send objects on their journey!</p>
        </div>
    </section>

    <!-- Stats -->
    <div class="container" id="game-stats-container" style="display:none">
        <div class="game-stats">
            <div class="timer">
                <i class="fas fa-clock"></i>
                <span id="time">05:00</span>
            </div>
           
            <div class="score">
                <i class="fas fa-star"></i>
                <span id="score" data-translate="score">Score: 0</span>
            </div>
           
            <div class="hints">
                <i class="fas fa-fire"></i>
                <span id="streak" data-translate="streak">Streak: 0</span>
            </div>
           
            <div class="progress-container">
                <div class="progress-bar" id="progress" style="width:0%"></div>
            </div>
        </div>
    </div>

    <!-- Game Area -->
    <section class="game-area" id="game-area" style="display:none">
        <div class="container">
            <div class="game-container">

                <!-- LEFT: object preview -->
                <div class="card object-preview" id="object-preview">
                    <div class="object-emoji" id="object-emoji">üéæ</div>
                    <div class="object-name" id="object-name">Ball</div>
                    <div class="object-desc small-muted" id="object-desc">Select properties below and click VERIFY to approve passport.</div>

                    <div style="margin-top:14px;text-align:center">
                        <div class="small-muted">Progress: <span id="placed-count">0</span>/<span id="total-count">0</span></div>
                    </div>
                </div>

                <!-- RIGHT: passport form -->
                <div class="card passport-card">
                    <div class="passport-title">OBJECT PASSPORT</div>

                    <div class="passport-form">
                        <div class="form-row">
                            <label data-translate="shape-label">Shape</label>
                            <select id="shape">
                                <option value="">Select shape</option>
                                <option>Round</option>
                                <option>Long</option>
                                <option>Square</option>
                                <option>Rectangular</option>
                                <option>Irregular</option>
                                <option>Cylindrical</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label data-translate="size-label">Size</label>
                            <select id="size">
                                <option value="">Select size</option>
                                <option>Small</option>
                                <option>Medium</option>
                                <option>Big</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label data-translate="colour-label">Colour</label>
                            <select id="colour">
                                <option value="">Select colour</option>
                                <option>Red</option>
                                <option>Blue</option>
                                <option>Grey</option>
                                <option>Silver</option>
                                <option>Brown</option>
                                <option>Black</option>
                                <option>Transparent</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label data-translate="material-label">Material</label>
                            <select id="material">
                                <option value="">Select material</option>
                                <option>Metal</option>
                                <option>Wood</option>
                                <option>Plastic</option>
                                <option>Rubber</option>
                                <option>Glass</option>
                                <option>Rock</option>
                                <option>Cloth</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label data-translate="texture-label">Texture</label>
                            <select id="texture">
                                <option value="">Select texture</option>
                                <option>Smooth</option>
                                <option>Rough</option>
                                <option>Soft</option>
                                <option>Hard</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <label data-translate="use-label">Use</label>
                            <select id="use">
                                <option value="">Select use</option>
                                <option>Eating</option>
                                <option>Storing water</option>
                                <option>Opening locks</option>
                                <option>Grooming</option>
                                <option>Writing</option>
                                <option>Playing</option>
                                <option>Measuring</option>
                                <option>Reading</option>
                                <option>None</option>
                            </select>
                        </div>

                        <button class="verify-btn" id="verify-btn" data-translate="verify-btn">Verify Passport</button>
                        <button class="retry-btn" id="retry-btn" data-translate="retry-btn">Try Again</button>
                    </div>
                </div>
            </div>

            <!-- Level Complete with Ranking -->
            <div class="level-complete" id="level-complete" style="display:none;">
                <div class="badge"><i class="fas fa-medal"></i></div>
                <h2 class="level-title" data-translate="level-title">Level Complete!</h2>
                <p class="level-text" data-translate="level-text">Congratulations! You've identified all object properties correctly. You're becoming a real object expert!</p>
               
                <!-- Score and Rank Display -->
                <div class="score-rank-container">
                    <div class="score-box pop-in">
                        <div class="score-label">Your Score</div>
                        <div class="score-value" id="final-score">0</div>
                    </div>
                    <div class="rank-box pop-in">
                        <div class="rank-label">Your Rank</div>
                        <div class="rank-value" id="final-rank">0</div>
                        <div class="rank-suffix" id="rank-suffix">th</div>
                    </div>
                </div>
               
                <!-- Leaderboard Preview -->
                <div class="leaderboard-preview" id="leaderboard-preview">
                    <div class="leaderboard-title">Top Players</div>
                    <div class="leaderboard-list" id="leaderboard-list">
                        <!-- Leaderboard items will be inserted here -->
                    </div>
                </div>
               
                <button class="next-level-btn" id="play-again-btn" data-translate="play-again-btn">Play Again</button>
            </div>
        </div>
    </section>

    <!-- Overlay for big passport + stamp -->
    <div class="passport-overlay" id="passport-overlay" aria-hidden="true" style="display:none">
        <div class="passport-card-large" id="passport-large">
            <div class="passport-large-left">
                <div id="overlay-emoji" style="font-size:4.6rem">üéæ</div>
                <div style="margin-top:8px;font-weight:800" id="overlay-name">Ball</div>
            </div>
            <div class="passport-large-center">
                <div style="font-weight:700;font-size:1.1rem;color:#1a365d;margin-bottom:8px">Passport Verification</div>
                <div id="overlay-text" style="color:#475569">All properties matched. Passport Approved!</div>
            </div>
            <div style="flex:0 0 240px;display:flex;align-items:center;justify-content:center">
                <div class="passport-stamp" id="overlay-stamp">APPROVED</div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="success-modal" id="success-modal">
        <div class="success-content">
            <div class="badge">
                <i class="fas fa-medal"></i>
            </div>
            <h2 class="success-title" data-translate="success-title">Level Complete!</h2>
            <p class="success-text" data-translate="success-text">You've earned the <strong>Object Expert</strong> badge!</p>
            <div class="did-you-know">
                <strong data-translate="did-you-know">Did you know?</strong>
                <p id="object-funfact">Objects have different properties that help us identify and classify them.</p>
            </div>
            <button class="next-btn" id="success-next-btn" data-translate="play-again-btn">Play Again</button>
        </div>
    </div>

    <script>
        // Check if user is logged in
        document.addEventListener('DOMContentLoaded', function() {
            const user = JSON.parse(localStorage.getItem('user'));
           
            if (!user) {
                // Redirect to login if not authenticated
                window.location.href = 'student-login.html';
                return;
            }
           
            // Load user data
            loadUserData(user);
           
            // Initialize the game
            init();
        });

        // Load user data into the page
        function loadUserData(user) {
            document.getElementById('headerUserName').textContent = user.fullName;
            document.getElementById('headerProfilePic').src = user.profilePicture ? `uploads/${user.profilePicture}` : 'default-profile.png';
        }

        /* ---- STATE ---- */
        let currentLang = 'en';
        let currentIndex = 0;
        let score = 0, streak = 0, correctCount = 0;
        let timeLeft = 300; // 5 minutes
        let timerInterval = null;
        let usedIds = [];
        let lastRejected = false;
        let isInInstructions = true;
        let currentObjects = [];
        let finalScore = 0;
        let userRank = 0;
        let gameName = 'Object Passport';

        /* ---- ELEMENTS ---- */
        const instructionsModal = document.getElementById('instructions-modal');
        const startGameBtn = document.getElementById('start-game-btn');
        const gameHeader = document.getElementById('game-header');
        const gameArea = document.getElementById('game-area');
        const statsContainer = document.getElementById('game-stats-container');
        const objectEmoji = document.getElementById('object-emoji');
        const objectName = document.getElementById('object-name');
        const objectDesc = document.getElementById('object-desc');
        const placedCount = document.getElementById('placed-count');
        const totalCount = document.getElementById('total-count');

        const shapeEl = document.getElementById('shape');
        const sizeEl = document.getElementById('size');
        const colourEl = document.getElementById('colour');
        const materialEl = document.getElementById('material');
        const textureEl = document.getElementById('texture');
        const useEl = document.getElementById('use');
        const verifyBtn = document.getElementById('verify-btn');
        const retryBtn = document.getElementById('retry-btn');

        const overlay = document.getElementById('passport-overlay');
        const overlayLarge = document.getElementById('passport-large');
        const overlayEmoji = document.getElementById('overlay-emoji');
        const overlayName = document.getElementById('overlay-name');
        const overlayText = document.getElementById('overlay-text');
        const overlayStamp = document.getElementById('overlay-stamp');

        const scoreEl = document.getElementById('score');
        const streakEl = document.getElementById('streak');
        const streakCounter = document.getElementById('streak-counter');
        const streakCountDisplay = document.getElementById('streak-count');
        const progressBar = document.getElementById('progress');

        const timeEl = document.getElementById('time');
        const levelComplete = document.getElementById('level-complete');
        const playAgainBtn = document.getElementById('play-again-btn');
        const successModal = document.getElementById('success-modal');
        const successNextBtn = document.getElementById('success-next-btn');

        // Leaderboard elements
        const finalScoreElement = document.getElementById('final-score');
        const finalRankElement = document.getElementById('final-rank');
        const rankSuffixElement = document.getElementById('rank-suffix');
        const leaderboardPreview = document.getElementById('leaderboard-preview');
        const leaderboardList = document.getElementById('leaderboard-list');

        // Language selector elements
        const languageOptionBtns = document.querySelectorAll('.language-option-btn');
        const langBtns = document.querySelectorAll('.lang-btn');

        // Dashboard integration elements
        const profileToggle = document.getElementById('profileToggle');
        const profileDropdown = document.getElementById('profileDropdown');
        const dropdownProfile = document.getElementById('dropdownProfile');
        const dropdownSettings = document.getElementById('dropdownSettings');
        const dropdownLogout = document.getElementById('dropdownLogout');
        const navHome = document.getElementById('navHome');
        const navScience = document.getElementById('navScience');
        const navAbout = document.getElementById('navAbout');
        const navContact = document.getElementById('navContact');

        /* ---- OBJECT DATABASE ---- */
        const objects = [
            { 
                id: 1, 
                icon: 'üî¥', 
                name: { en: 'Red Rubber Ball', or: '‡¨∞‡≠á‡¨°‡≠ç ‡¨∞‡¨¨‡¨∞ ‡¨¨‡¨≤‡≠ç', hi: '‡§≤‡§æ‡§≤ ‡§∞‡§¨‡§∞ ‡§ï‡•Ä ‡§ó‡•á‡§Ç‡§¶' }, 
                shape: 'Round', 
                size: 'Medium', 
                colour: 'Red', 
                material: 'Rubber', 
                texture: 'Smooth', 
                use: 'Playing',
                funfact: 'Rubber balls bounce because of their elastic material that stores and releases energy.'
            },
            { 
                id: 2, 
                icon: 'ü•Ñ', 
                name: { en: 'Metal Spoon', or: '‡¨Æ‡≠á‡¨ü‡¨æ‡¨≤‡≠ç ‡¨ö‡¨Æ‡¨ö', hi: '‡§ß‡§æ‡§§‡•Å ‡§ï‡§æ ‡§ö‡§Æ‡•ç‡§Æ‡§ö' }, 
                shape: 'Long', 
                size: 'Small', 
                colour: 'Silver', 
                material: 'Metal', 
                texture: 'Smooth', 
                use: 'Eating',
                funfact: 'Spoons are one of the oldest eating utensils, dating back to prehistoric times.'
            },
            { 
                id: 3, 
                icon: 'üü´', 
                name: { en: 'Wooden Block', or: '‡¨ï‡¨æ‡¨† ‡¨¨‡≠ç‡¨≤‡¨ï‡≠ç', hi: '‡§≤‡§ï‡§°‡§º‡•Ä ‡§ï‡§æ ‡§¨‡•ç‡§≤‡•â‡§ï' }, 
                shape: 'Square', 
                size: 'Medium', 
                colour: 'Brown', 
                material: 'Wood', 
                texture: 'Rough', 
                use: 'None',
                funfact: 'Wooden blocks help develop spatial reasoning and problem-solving skills in children.'
            },
            { 
                id: 4, 
                icon: 'üß¥', 
                name: { en: 'Blue Plastic Bottle', or: '‡¨¨‡≠ç‡¨≤‡≠Å ‡¨™‡≠ç‡¨≤‡¨æ‡¨∑‡≠ç‡¨ü‡¨ø‡¨ï‡≠ç ‡¨¨‡≠ã‡¨§‡¨≤‡≠ç', hi: '‡§®‡•Ä‡§≤‡•Ä ‡§™‡•ç‡§≤‡§æ‡§∏‡•ç‡§ü‡§ø‡§ï ‡§ï‡•Ä ‡§¨‡•ã‡§§‡§≤' }, 
                shape: 'Cylindrical', 
                size: 'Medium', 
                colour: 'Blue', 
                material: 'Plastic', 
                texture: 'Smooth', 
                use: 'Storing water',
                funfact: 'Plastic bottles can take up to 450 years to decompose in the environment.'
            },
            { 
                id: 5, 
                icon: 'üîë', 
                name: { en: 'Silver Key', or: '‡¨∏‡¨ø‡¨≤‡≠ç‡¨≠‡¨∞ ‡¨ö‡¨æ‡¨¨‡¨ø', hi: '‡§ö‡§æ‡§Ç‡§¶‡•Ä ‡§ï‡•Ä ‡§ö‡§æ‡§¨‡•Ä' }, 
                shape: 'Long', 
                size: 'Small', 
                colour: 'Silver', 
                material: 'Metal', 
                texture: 'Smooth', 
                use: 'Opening locks',
                funfact: 'The earliest keys were made of wood and were used in ancient Egypt over 4,000 years ago.'
            },
            { 
                id: 6, 
                icon: 'ü´ô', 
                name: { en: 'Glass Cup', or: '‡¨ó‡≠ç‡¨≤‡¨æ‡¨∏‡≠ç ‡¨ï‡¨™‡≠ç', hi: '‡§ï‡§æ‡§Ç‡§ö ‡§ï‡§æ ‡§™‡•ç‡§Ø‡§æ‡§≤‡§æ' }, 
                shape: 'Cylindrical', 
                size: 'Small', 
                colour: 'Transparent', 
                material: 'Glass', 
                texture: 'Smooth', 
                use: 'None',
                funfact: 'Glass is made from sand, soda ash, and limestone heated to extremely high temperatures.'
            },
            { 
                id: 7, 
                icon: 'ü™®', 
                name: { en: 'Grey Stone', or: '‡¨ó‡≠ç‡¨∞‡≠á ‡¨™‡¨•‡¨∞', hi: '‡§ó‡•ç‡§∞‡•á ‡§™‡§§‡•ç‡§•‡§∞' }, 
                shape: 'Irregular', 
                size: 'Medium', 
                colour: 'Grey', 
                material: 'Rock', 
                texture: 'Rough', 
                use: 'None',
                funfact: 'Rocks are made of minerals and are classified into three types: igneous, sedimentary, and metamorphic.'
            },
            { 
                id: 8, 
                icon: 'üìè', 
                name: { en: 'Yellow Ruler', or: '‡¨π‡¨≥‡¨¶‡¨ø‡¨Ü ‡¨∞‡≠Å‡¨≤‡¨∞‡≠ç', hi: '‡§™‡•Ä‡§≤‡§æ ‡§™‡•à‡§Æ‡§æ‡§®‡§æ' }, 
                shape: 'Long', 
                size: 'Small', 
                colour: 'Yellow', 
                material: 'Plastic', 
                texture: 'Smooth', 
                use: 'Measuring',
                funfact: 'The first rulers were made of ivory and used by the Indus Valley Civilization around 1500 BCE.'
            },
            { 
                id: 9, 
                icon: 'üìò', 
                name: { en: 'Blue Book', or: '‡¨®‡≠Ä‡¨≥ ‡¨¨‡¨π‡¨ø', hi: '‡§®‡•Ä‡§≤‡•Ä ‡§ï‡§ø‡§§‡§æ‡§¨' }, 
                shape: 'Rectangular', 
                size: 'Medium', 
                colour: 'Blue', 
                material: 'Paper', 
                texture: 'Smooth', 
                use: 'Reading',
                funfact: 'The oldest known printed book is the Diamond Sutra, a Buddhist text from 868 AD.'
            },
            { 
                id: 10, 
                icon: '‚úèÔ∏è', 
                name: { en: 'Pencil', or: '‡¨™‡≠á‡¨®‡≠ç‡¨∏‡¨ø‡¨≤‡≠ç', hi: '‡§™‡•á‡§Ç‡§∏‡§ø‡§≤' }, 
                shape: 'Long', 
                size: 'Small', 
                colour: 'Yellow', 
                material: 'Wood', 
                texture: 'Smooth', 
                use: 'Writing',
                funfact: 'The average pencil can draw a line 35 miles long or write about 45,000 words.'
            }
        ];

        /* ---- TRANSLATIONS ---- */
        const translations = {
            en: {
                'nav-dashboard': 'Dashboard',
                'nav-science': 'Science',
                'nav-about': 'About',
                'nav-contact': 'Contact',
                'dropdown-profile': 'Profile',
                'dropdown-settings': 'Settings',
                'dropdown-logout': 'Logout',
                'game-title': 'Object Passport Builder',
                'game-desc': 'Identify object properties and approve passports to send objects on their journey!',
                'instructions-title': 'How to Play Object Passport',
                'instructions-intro': 'Welcome to Object Passport! Help objects travel by creating their passports with the correct properties:',
                'instruction-1': 'An object will appear on the screen with its image.',
                'instruction-2': 'Select the correct properties for the object from the options provided.',
                'instruction-3': 'Properties include shape, size, color, material, texture, and more.',
                'instruction-4': 'Click the "Verify Passport" button to check your answers.',
                'instruction-5': 'If all answers are correct, the passport gets APPROVED with a green stamp!',
                'instruction-6': 'If any answer is wrong, the passport gets REJECTED with a red stamp and you can try again.',
                'instructions-outro': 'Help all the objects get their passports approved so they can travel!',
                'start-game-btn': 'Start Game',
                'verify-btn': 'Verify Passport',
                'retry-btn': 'Try Again',
                'success-title': 'Level Complete!',
                'success-text': 'You\'ve earned the <strong>Object Expert</strong> badge!',
                'did-you-know': 'Did you know?',
                'play-again-btn': 'Play Again',
                'level-complete': 'Level Complete!',
                'level-text': 'Congratulations! You\'ve identified all object properties correctly. You\'re becoming a real object expert!',
                'level-title': 'Level Complete!',
                'score': 'Score: ',
                'streak': 'Streak: ',
                'shape-label': 'Shape',
                'size-label': 'Size',
                'colour-label': 'Colour',
                'material-label': 'Material',
                'texture-label': 'Texture',
                'use-label': 'Use',
                'timer-label': 'Time',
                'play-again': 'Play Again'
            },
            or: {
                'nav-dashboard': '‡¨°‡≠ç‡≠ü‡¨æ‡¨∏‡¨¨‡≠ã‡¨∞‡≠ç‡¨°',
                'nav-science': '‡¨¨‡¨ø‡¨ú‡≠ç‡¨û‡¨æ‡¨®',
                'nav-about': '‡¨¨‡¨ø‡¨∑‡≠ü‡¨∞‡≠á',
                'nav-contact': '‡¨Ø‡≠ã‡¨ó‡¨æ‡¨Ø‡≠ã‡¨ó',
                'dropdown-profile': '‡¨™‡≠ç‡¨∞‡≠ã‡¨´‡¨æ‡¨á‡¨≤‡≠ç',
                'dropdown-settings': '‡¨∏‡≠á‡¨ü‡¨ø‡¨Ç‡¨∏‡≠ç',
                'dropdown-logout': '‡¨≤‡¨ó‡¨Ü‡¨â‡¨ü‡≠ç',
                'game-title': '‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨¨‡¨ø‡¨≤‡≠ç‡¨°‡¨∞‡≠ç',
                'game-desc': '‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨ó‡≠Å‡¨£‡¨ó‡≠Å‡¨°‡¨ø‡¨ï ‡¨ö‡¨ø‡¨π‡≠ç‡¨®‡¨ü ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å ‡¨è‡¨¨‡¨Ç ‡¨¨‡¨∏‡≠ç‡¨§‡≠Å‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡≠Å ‡¨∏‡≠á‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï ‡¨Ø‡¨æ‡¨§‡≠ç‡¨∞‡¨æ‡¨∞‡≠á ‡¨™‡¨†‡¨æ‡¨á‡¨¨‡¨æ ‡¨™‡¨æ‡¨á‡¨Å ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨Ö‡¨®‡≠Å‡¨Æ‡≠ã‡¨¶‡¨® ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å!',
                'instructions-title': '‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨ï‡¨ø‡¨™‡¨∞‡¨ø ‡¨ñ‡≠á‡¨≥‡¨ø‡¨¨‡≠á',
                'instructions-intro': '‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü‡¨ï‡≠Å ‡¨∏‡≠ç‡≠±‡¨æ‡¨ó‡¨§! ‡¨∏‡¨†‡¨ø‡¨ï‡≠ç ‡¨ó‡≠Å‡¨£‡¨ó‡≠Å‡¨°‡¨ø‡¨ï ‡¨∏‡¨π‡¨ø‡¨§ ‡¨¨‡¨∏‡≠ç‡¨§‡≠Å‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨∏‡≠É‡¨∑‡≠ç‡¨ü‡¨ø ‡¨ï‡¨∞‡¨ø ‡¨∏‡≠á‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡≠Å ‡¨≠‡≠ç‡¨∞‡¨Æ‡¨£‡¨∞‡≠á ‡¨∏‡¨æ‡¨π‡¨æ‡¨Ø‡≠ç‡≠ü ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å:',
                'instruction-1': '‡¨è‡¨ï ‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨§‡¨æ‡¨π‡¨æ‡¨∞ ‡¨õ‡¨¨‡¨ø ‡¨∏‡¨π‡¨ø‡¨§ ‡¨™‡¨∞‡¨¶‡¨æ‡¨∞‡≠á ‡¨¶‡≠á‡¨ñ‡¨æ‡¨Ø‡¨ø‡¨¨‡•§',
                'instruction-2': '‡¨™‡≠ç‡¨∞‡¨¶‡¨æ‡¨® ‡¨ï‡¨∞‡¨æ‡¨Ø‡¨æ‡¨á‡¨•‡¨ø‡¨¨‡¨æ ‡¨¨‡¨ø‡¨ï‡¨≥‡≠ç‡¨™‡¨ó‡≠Å‡¨°‡¨ø‡¨ï‡¨∞‡≠Å ‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨™‡¨æ‡¨á‡¨Å ‡¨∏‡¨†‡¨ø‡¨ï‡≠ç ‡¨ó‡≠Å‡¨£‡¨ó‡≠Å‡¨°‡¨ø‡¨ï ‡¨¨‡¨æ‡¨õ‡¨®‡≠ç‡¨§‡≠Å‡•§',
                'instruction-3': '‡¨ó‡≠Å‡¨£‡¨ó‡≠Å‡¨°‡¨ø‡¨ï‡¨∞‡≠á ‡¨Ü‡¨ï‡≠É‡¨§‡¨ø, ‡¨Ü‡¨ï‡¨æ‡¨∞, ‡¨∞‡¨ô‡≠ç‡¨ó, ‡¨™‡¨¶‡¨æ‡¨∞‡≠ç‡¨•, ‡¨ó‡¨†‡¨®, ‡¨è‡¨¨‡¨Ç ‡¨Ö‡¨®‡≠ç‡≠ü‡¨æ‡¨®‡≠ç‡≠ü ‡¨Ö‡¨®‡≠ç‡¨§‡¨∞‡≠ç‡¨≠‡≠Å‡¨ï‡≠ç‡¨§ ‡¨Ö‡¨õ‡¨®‡≠ç‡¨§‡¨ø‡•§',
                'instruction-4': '‡¨Ü‡¨™‡¨£‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨Ø‡¨æ‡¨û‡≠ç‡¨ö ‡¨ï‡¨∞‡¨ø‡¨¨‡¨æ‡¨ï‡≠Å "‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨Ø‡¨æ‡¨û‡≠ç‡¨ö ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å" ‡¨¨‡¨ü‡¨®‡≠ç ‡¨ï‡≠ç‡¨≤‡¨ø‡¨ï‡≠ç ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å‡•§',
                'instruction-5': '‡¨Ø‡¨¶‡¨ø ‡¨∏‡¨Æ‡¨∏‡≠ç‡¨§ ‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨∏‡¨†‡¨ø‡¨ï‡≠ç ‡¨Ö‡¨õ‡¨ø, ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨è‡¨ï ‡¨∏‡¨¨‡≠Å‡¨ú ‡¨∏‡≠ç‡¨ü‡¨æ‡¨Æ‡≠ç‡¨™ ‡¨∏‡¨π‡¨ø‡¨§ ‡¨Ö‡¨®‡≠Å‡¨Æ‡≠ã‡¨¶‡¨ø‡¨§ ‡¨π‡≠Å‡¨è!',
                'instruction-6': '‡¨Ø‡¨¶‡¨ø ‡¨ï‡≠å‡¨£‡¨∏‡¨ø ‡¨â‡¨§‡≠ç‡¨§‡¨∞ ‡¨≠‡≠Å‡¨≤‡≠ç ‡¨Ö‡¨õ‡¨ø, ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨è‡¨ï ‡¨≤‡¨æ‡¨≤‡≠ç ‡¨∏‡≠ç‡¨ü‡¨æ‡¨Æ‡≠ç‡¨™ ‡¨∏‡¨π‡¨ø‡¨§ ‡¨™‡≠ç‡¨∞‡¨§‡≠ç‡≠ü‡¨æ‡¨ñ‡≠ç‡≠ü‡¨æ‡¨® ‡¨ï‡¨∞‡¨æ‡¨Ø‡¨æ‡¨è ‡¨è‡¨¨‡¨Ç ‡¨Ü‡¨™‡¨£ ‡¨™‡≠Å‡¨®‡¨∞‡≠ç‡¨¨‡¨æ‡¨∞ ‡¨ö‡≠á‡¨∑‡≠ç‡¨ü‡¨æ ‡¨ï‡¨∞‡¨ø‡¨™‡¨æ‡¨∞‡¨ø‡¨¨‡≠á‡•§',
                'instructions-outro': '‡¨∏‡¨Æ‡¨∏‡≠ç‡¨§ ‡¨¨‡¨∏‡≠ç‡¨§‡≠Å‡¨Æ‡¨æ‡¨®‡¨ô‡≠ç‡¨ï‡¨∞ ‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨Ö‡¨®‡≠Å‡¨Æ‡≠ã‡¨¶‡¨ø‡¨§ ‡¨π‡≠á‡¨¨‡¨æ ‡¨™‡¨æ‡¨á‡¨Å ‡¨∏‡¨æ‡¨π‡¨æ‡¨Ø‡≠ç‡≠ü ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å ‡¨Ø‡¨æ‡¨π‡¨æ ‡¨¶‡≠ç‡≠±‡¨æ‡¨∞‡¨æ ‡¨∏‡≠á‡¨Æ‡¨æ‡¨®‡≠á ‡¨≠‡≠ç‡¨∞‡¨Æ‡¨£ ‡¨ï‡¨∞‡¨ø‡¨™‡¨æ‡¨∞‡¨ø‡¨¨‡≠á!',
                'start-game-btn': '‡¨ñ‡≠á‡¨≥ ‡¨Ü‡¨∞‡¨Æ‡≠ç‡¨≠ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å',
                'verify-btn': '‡¨™‡¨æ‡¨∏‡¨™‡≠ã‡¨∞‡≠ç‡¨ü ‡¨Ø‡¨æ‡¨û‡≠ç‡¨ö ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å',
                'retry-btn': '‡¨™‡≠Å‡¨®‡¨∞‡≠ç‡¨¨‡¨æ‡¨∞ ‡¨ö‡≠á‡¨∑‡≠ç‡¨ü‡¨æ ‡¨ï‡¨∞‡¨®‡≠ç‡¨§‡≠Å',
                'success-title': '‡¨∏‡≠ç‡¨§‡¨∞ ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£!',
                'success-text': '‡¨Ü‡¨™‡¨£ <strong>‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨¨‡¨ø‡¨∂‡≠á‡¨∑‡¨ú‡≠ç‡¨û</strong> ‡¨¨‡≠ç‡≠ü‡¨æ‡¨ú‡≠ç ‡¨Ö‡¨∞‡≠ç‡¨ú‡¨® ‡¨ï‡¨∞‡¨ø‡¨õ‡¨®‡≠ç‡¨§‡¨ø!',
                'did-you-know': '‡¨Ü‡¨™‡¨£ ‡¨ú‡¨æ‡¨£‡¨ø‡¨õ‡¨®‡≠ç‡¨§‡¨ø ‡¨ï‡¨ø?',
                'play-again-btn': '‡¨™‡≠Å‡¨®‡¨∞‡≠ç‡¨¨‡¨æ‡¨∞ ‡¨ñ‡≠á‡¨≥‡¨®‡≠ç‡¨§‡≠Å',
                'level-complete': '‡¨∏‡≠ç‡¨§‡¨∞ ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£!',
                'level-text': '‡¨Ö‡¨≠‡¨ø‡¨®‡¨®‡≠ç‡¨¶‡¨®! ‡¨Ü‡¨™‡¨£ ‡¨¨‡¨∏‡≠ç‡¨§‡≠Å ‡¨ó‡≠Å‡¨£‡¨ó‡≠Å‡¨°‡¨ø‡¨ï‡≠Å ‡¨∏‡¨†‡¨ø‡¨ï ‡¨≠‡¨æ‡¨¨‡¨∞‡≠á ‡¨ö‡¨ø‡¨π‡≠ç‡¨®‡¨ø‡¨õ‡¨®‡≠ç‡¨§‡¨ø!',
                'level-title': '‡¨∏‡≠ç‡¨§‡¨∞ ‡¨∏‡¨Æ‡≠ç‡¨™‡≠Ç‡¨∞‡≠ç‡¨£‡≠ç‡¨£!',
                'score': '‡¨∏‡≠ç‡¨ï‡≠ã‡¨∞: ',
                'streak': '‡¨∑‡≠ç‡¨ü‡≠ç‡¨∞‡¨ø‡¨ï‡≠ç: ',
                'shape-label': '‡¨Ü‡¨ï‡≠É‡¨§‡¨ø',
                'size-label': '‡¨Ü‡¨ï‡¨æ‡¨∞',
                'colour-label': '‡¨∞‡¨ô‡≠ç‡¨ó',
                'material-label': '‡¨™‡¨¶‡¨æ‡¨∞‡≠ç‡¨•',
                'texture-label': '‡¨ó‡¨†‡¨®',
                'use-label': '‡¨¨‡≠ç‡≠ü‡¨¨‡¨π‡¨æ‡¨∞',
                'timer-label': '‡¨∏‡¨Æ‡≠ü',
                'play-again': '‡¨™‡≠Å‡¨£‡¨ø ‡¨ñ‡≠á‡¨≥‡¨®‡≠ç‡¨§‡≠Å'
            },
            hi: {
                'nav-dashboard': '‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°',
                'nav-science': '‡§µ‡§ø‡§ú‡•ç‡§û‡§æ‡§®',
                'nav-about': '‡§π‡§Æ‡§æ‡§∞‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç',
                'nav-contact': '‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç',
                'dropdown-profile': '‡§™‡•ç‡§∞‡•ã‡§´‡§æ‡§á‡§≤',
                'dropdown-settings': '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
                'dropdown-logout': '‡§≤‡•â‡§ó‡§Ü‡§â‡§ü',
                'game-title': '‡§µ‡§∏‡•ç‡§§‡•Å ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§ø‡§≤‡•ç‡§°‡§∞',
                'game-desc': '‡§µ‡§∏‡•ç‡§§‡•Å ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§ï‡•Ä ‡§™‡§π‡§ö‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•ã ‡§â‡§®‡§ï‡•Ä ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§™‡§∞ ‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§ï‡§∞‡•á‡§Ç!',
                'instructions-title': '‡§µ‡§∏‡•ç‡§§‡•Å ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡•à‡§∏‡•á ‡§ñ‡•á‡§≤‡•á‡§Ç',
                'instructions-intro': '‡§µ‡§∏‡•ç‡§§‡•Å ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§∏‡§π‡•Ä ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•á ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§®‡§æ‡§ï‡§∞ ‡§â‡§®‡•ç‡§π‡•á‡§Ç ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•á‡§Ç:',
                'instruction-1': '‡§è‡§ï ‡§µ‡§∏‡•ç‡§§‡•Å ‡§â‡§∏‡§ï‡•Ä ‡§õ‡§µ‡§ø ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡•Ä‡•§',
                'instruction-2': '‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§ø‡§è ‡§ó‡§è ‡§µ‡§ø‡§ï‡§≤‡•ç‡§™‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•á ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§π‡•Ä ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§ï‡§æ ‡§ö‡§Ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§',
                'instruction-3': '‡§ó‡•Å‡§£‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ü‡§ï‡§æ‡§∞, ‡§Ü‡§ï‡§æ‡§∞, ‡§∞‡§Ç‡§ó, ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä, ‡§¨‡§®‡§æ‡§µ‡§ü ‡§î‡§∞ ‡§Ö‡§ß‡§ø‡§ï ‡§∂‡§æ‡§Æ‡§ø‡§≤ ‡§π‡•à‡§Ç‡•§',
                'instruction-4': '‡§Ö‡§™‡§®‡•á ‡§â‡§§‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§ú‡§æ‡§Ç‡§ö ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è "‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç" ‡§¨‡§ü‡§® ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§',
                'instruction-5': '‡§Ø‡§¶‡§ø ‡§∏‡§≠‡•Ä ‡§â‡§§‡•ç‡§§‡§∞ ‡§∏‡§π‡•Ä ‡§π‡•à‡§Ç, ‡§§‡•ã ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§π‡§∞‡•á ‡§∞‡§Ç‡§ó ‡§ï‡•á ‡§∏‡•ç‡§ü‡§æ‡§Ç‡§™ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à!',
                'instruction-6': '‡§Ø‡§¶‡§ø ‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§§‡§∞ ‡§ó‡§≤‡§§ ‡§π‡•à, ‡§§‡•ã ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§≤‡§æ‡§≤ ‡§∏‡•ç‡§ü‡§æ‡§Ç‡§™ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§π‡•ã ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‡§î‡§∞ ‡§Ü‡§™ ‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§',
                'instructions-outro': '‡§∏‡§≠‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å‡§ì‡§Ç ‡§ï‡•á ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•ç‡§µ‡•Ä‡§ï‡•É‡§§ ‡§π‡•ã‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§µ‡•á ‡§Ø‡§æ‡§§‡•ç‡§∞‡§æ ‡§ï‡§∞ ‡§∏‡§ï‡•á‡§Ç!',
                'start-game-btn': '‡§ñ‡•á‡§≤ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç',
                'verify-btn': '‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                'retry-btn': '‡§´‡§ø‡§∞ ‡§∏‡•á ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç',
                'success-title': '‡§∏‡•ç‡§§‡§∞ ‡§™‡•Ç‡§∞‡§æ!',
                'success-text': '‡§Ü‡§™‡§®‡•á <strong>‡§µ‡§∏‡•ç‡§§‡•Å ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û</strong> ‡§¨‡•à‡§ú ‡§Ö‡§∞‡•ç‡§ú‡§ø‡§§ ‡§ï‡§ø‡§Ø‡§æ ‡§π‡•à!',
                'did-you-know': '‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§ú‡§æ‡§®‡§§‡•á ‡§π‡•à‡§Ç?',
                'play-again-btn': '‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ñ‡•á‡§≤‡•á‡§Ç',
                'level-complete': '‡§∏‡•ç‡§§‡§∞ ‡§™‡•Ç‡§∞‡§æ!',
                'level-text': '‡§¨‡§ß‡§æ‡§à ‡§π‡•ã! ‡§Ü‡§™‡§®‡•á ‡§∏‡§≠‡•Ä ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ó‡•Å‡§£‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§¢‡§Ç‡§ó ‡§∏‡•á ‡§™‡§π‡§ö‡§æ‡§® ‡§≤‡§ø‡§Ø‡§æ ‡§π‡•à‡•§',
                'level-title': '‡§∏‡•ç‡§§‡§∞ ‡§™‡•Ç‡§∞‡§æ!',
                'score': '‡§∏‡•ç‡§ï‡•ã‡§∞: ',
                'streak': '‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä‡§ï: ',
                'shape-label': '‡§Ü‡§ï‡§æ‡§∞',
                'size-label': '‡§Ü‡§ï‡§æ‡§∞',
                'colour-label': '‡§∞‡§Ç‡§ó',
                'material-label': '‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä',
                'texture-label': '‡§¨‡§®‡§æ‡§µ‡§ü',
                'use-label': '‡§â‡§™‡§Ø‡•ã‡§ó',
                'timer-label': '‡§∏‡§Æ‡§Ø',
                'play-again': '‡§´‡§ø‡§∞ ‡§∏‡•á ‡§ñ‡•á‡§≤‡•á‡§Ç'
            }
        };

        /* ---- INITIALIZATION ---- */
        function init() {
            createParticles();

            // Add event listeners to all language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    switchLanguage(lang);
                });
            });

            // Add event listeners to horizontal language selector
            languageOptionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.getAttribute('data-lang');
                    // Update active button
                    languageOptionBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    switchLanguage(lang);
                });
            });

            // Game buttons
            startGameBtn.addEventListener('click', startGame);
            verifyBtn.addEventListener('click', verifyPassport);
            retryBtn.addEventListener('click', retryPassport);
            playAgainBtn.addEventListener('click', () => {
                resetGame();
                startGame();
            });
            successNextBtn.addEventListener('click', () => {
                successModal.style.display = 'none';
                resetGame();
                startGame();
            });

            // Dashboard integration event listeners
            profileToggle.addEventListener('click', function() {
                profileDropdown.classList.toggle('show');
            });

            // Navigation between pages
            dropdownProfile.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'student-dashboard.html#profile';
            });

            dropdownSettings.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'student-dashboard.html#settings';
            });

            dropdownLogout.addEventListener('click', function(e) {
                e.preventDefault();
                localStorage.removeItem('user');
                window.location.href = 'student-login.html';
            });

            // Navigation menu items
            navHome.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'student-dashboard.html';
            });

            navScience.addEventListener('click', function(e) {
                e.preventDefault();
                window.location.href = 'science.html';
            });

            navAbout.addEventListener('click', function(e) {
                e.preventDefault();
                alert('About page would open here');
            });

            navContact.addEventListener('click', function(e) {
                e.preventDefault();
                alert('Contact page would open here');
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#profileToggle') && !e.target.closest('#profileDropdown')) {
                    profileDropdown.classList.remove('show');
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    overlayHide();
                }
                if (e.key === '1') switchLanguage('en'); 
                if (e.key === '2') switchLanguage('or'); 
                if (e.key === '3') switchLanguage('hi');
            });

            switchLanguage('en');
        }

        /* ---- GAME FUNCTIONS ---- */
        function createParticles() {
            const container = document.getElementById('particles');
            container.innerHTML = '';
            for (let i = 0; i < 18; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                p.style.top = Math.random() * 100 + '%';
                p.style.animationDelay = `${Math.random() * 10}s`;
                container.appendChild(p);
            }
        }

        function switchLanguage(lang) {
            currentLang = lang;
           
            // Update all language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang')===lang);
            });
           
            // Update horizontal language selector
            languageOptionBtns.forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-lang')===lang);
            });
           
            // translate elements
            const map = translations[lang] || translations.en;
            Object.keys(map).forEach(key => {
                document.querySelectorAll(`[data-translate="${key}"]`).forEach(el => {
                    if (key === 'success-text') {
                        el.innerHTML = map[key];
                    } else {
                        el.textContent = map[key];
                    }
                });
            });

            // Update score and streak with current values
            updateScore();
            updateStreak();

            // Update instruction elements
            updateInstructionTranslations();

            // Update current object name if in game
            if (!isInInstructions && currentObjects.length > 0 && currentIndex < currentObjects.length) {
                const obj = currentObjects[currentIndex];
                objectName.textContent = obj.name[currentLang] || obj.name.en;
            }

            // apply language-specific font classes
            if (lang === 'or') {
                document.body.classList.add('odia-text');
                document.body.classList.remove('hindi-text');
            } else if (lang === 'hi') {
                document.body.classList.add('hindi-text');
                document.body.classList.remove('odia-text');
            } else {
                document.body.classList.remove('odia-text');
                document.body.classList.remove('hindi-text');
            }
        }

        function updateInstructionTranslations() {
            const instructionsTitle = document.getElementById('instructions-title');
            const instructionsIntro = document.getElementById('instructions-intro');
            const instruction1 = document.getElementById('instruction-1');
            const instruction2 = document.getElementById('instruction-2');
            const instruction3 = document.getElementById('instruction-3');
            const instruction4 = document.getElementById('instruction-4');
            const instruction5 = document.getElementById('instruction-5');
            const instruction6 = document.getElementById('instruction-6');
            const instructionsOutro = document.getElementById('instructions-outro');
            const startGameBtn = document.getElementById('start-game-btn');

            if (translations[currentLang]) {
                if (instructionsTitle) instructionsTitle.textContent = translations[currentLang]['instructions-title'];
                if (instructionsIntro) instructionsIntro.textContent = translations[currentLang]['instructions-intro'];
                if (instruction1) instruction1.textContent = translations[currentLang]['instruction-1'];
                if (instruction2) instruction2.textContent = translations[currentLang]['instruction-2'];
                if (instruction3) instruction3.textContent = translations[currentLang]['instruction-3'];
                if (instruction4) instruction4.textContent = translations[currentLang]['instruction-4'];
                if (instruction5) instruction5.textContent = translations[currentLang]['instruction-5'];
                if (instruction6) instruction6.textContent = translations[currentLang]['instruction-6'];
                if (instructionsOutro) instructionsOutro.textContent = translations[currentLang]['instructions-outro'];
                if (startGameBtn) startGameBtn.textContent = translations[currentLang]['start-game-btn'];
            }
        }

        function startGame() {
            isInInstructions = false;
            instructionsModal.style.display = 'none';
            gameHeader.style.display = 'block';
            statsContainer.style.display = 'block';
            gameArea.style.display = 'block';
            levelComplete.style.display = 'none';
            successModal.style.display = 'none';
            retryBtn.style.display = 'none';
            verifyBtn.style.display = 'block';

            // Update all translations when starting the game
            switchLanguage(currentLang);

            // Reset game state
            score = 0;
            streak = 0;
            correctCount = 0;
            usedIds = [];
            lastRejected = false;
            updateScore();
            updateStreak();

            // Shuffle objects - NEW RANDOMIZATION EVERY TIME
            currentObjects = [...objects].sort(() => Math.random() - 0.5);
            usedIds = currentObjects.map(it => it.id);
            currentIndex = 0;
            placedCount.textContent = correctCount;
            totalCount.textContent = objects.length;

            loadCurrent();
            startTimer();
        }

        function loadCurrent() {
            const obj = currentObjects[currentIndex];
            if (!obj) return;
            objectEmoji.textContent = obj.icon;
            objectName.textContent = obj.name[currentLang] || obj.name.en;
            objectDesc.textContent = 'Select the correct properties and click VERIFY PASSPORT.';
            // Clear selects
            [shapeEl, sizeEl, colourEl, materialEl, textureEl, useEl].forEach(s => s.value = '');
        }

        function verifyPassport() {
            const obj = currentObjects[currentIndex];
            // Compare values
            const ok =
                (shapeEl.value === obj.shape) &&
                (sizeEl.value === obj.size) &&
                (colourEl.value === obj.colour) &&
                (materialEl.value === obj.material) &&
                (textureEl.value === obj.texture) &&
                (useEl.value === obj.use);

            if (ok) {
                correctCount++;
                score += 10 + Math.min(streak * 2, 20);
                streak++;
                showOverlay(true, obj);
                setTimeout(() => {
                    nextObject();
                }, 1600);
            } else {
                streak = 0;
                score = Math.max(0, score - 5);
                updateScore();
                updateStreak();
                showOverlay(false, obj);
                lastRejected = true;
                // Show retry button
                setTimeout(() => {
                    retryBtn.style.display = 'block';
                    verifyBtn.style.display = 'none';
                }, 1500);
            }
        }

        function retryPassport() {
            retryBtn.style.display = 'none';
            verifyBtn.style.display = 'block';
            overlayHide();
        }

        async function nextObject() {
            currentIndex++;
            updateScore();
            updateStreak();
            placedCount.textContent = correctCount;
            const pct = Math.round((correctCount / objects.length) * 100);
            progressBar.style.width = pct + '%';

            if (currentIndex >= currentObjects.length) {
                await finishLevel();
                return;
            }
            // Show next
            setTimeout(() => {
                overlayHide();
                loadCurrent();
            }, 700);
        }

        async function finishLevel() {
            clearInterval(timerInterval);
            const timeBonus = Math.max(0, Math.floor(timeLeft/10) * 5);
            score += timeBonus;
            finalScore = score;
            updateScore();
           
            // Save score to server and get rank
            try {
                const user = JSON.parse(localStorage.getItem('user'));
                if (user && user.id) {
                    const result = await saveGameResult(user.id, finalScore);
                   
                    if (result && result.rank) {
                        // Get leaderboard data
                        const leaderboardData = await getGameLeaderboard(gameName);
                       
                        // Display final results
                        displayFinalResults(finalScore, result.rank, leaderboardData);
                    } else {
                        displayFinalResults(finalScore, result?.rank || 1, []);
                    }
                } else {
                    // Fallback if no user logged in
                    displayFinalResults(finalScore, 1, []);
                }
            } catch (error) {
                console.error('Error saving game result:', error);
                displayFinalResults(finalScore, 1, []);
            }
           
            // Show level complete with ranking
            levelComplete.style.display = 'block';
            successModal.style.display = 'flex';
        }

        function resetGame() {
            currentIndex = 0;
            score = 0;
            streak = 0;
            correctCount = 0;
            lastRejected = false;
            updateScore();
            updateStreak();
            progressBar.style.width = '0%';
            placedCount.textContent = '0';
            overlayHide();
            retryBtn.style.display = 'none';
            verifyBtn.style.display = 'block';
            levelComplete.style.display = 'none';
        }

        function showOverlay(isApproved, obj) {
            overlay.style.display = 'flex';
            setTimeout(() => overlayLarge.classList.add('show'), 10);

            overlayEmoji.textContent = obj.icon;
            overlayName.textContent = obj.name[currentLang] || obj.name.en;

            if (isApproved) {
                overlayText.textContent = (currentLang === 'en') ? 'All properties matched. Passport Approved!' : 'Passport Approved!';
                overlayStamp.textContent = 'APPROVED';
                overlayStamp.classList.remove('rejected');
                overlayStamp.classList.add('approved', 'show');
                overlayStamp.style.background = '#16a34a';
                // Update score/streak after small delay
                setTimeout(() => {
                    updateScore();
                    updateStreak();
                }, 250);
            } else {
                overlayText.textContent = (currentLang === 'en') ? 'Some properties are incorrect. Passport Rejected.' : 'Passport Rejected.';
                overlayStamp.textContent = 'REJECTED';
                overlayStamp.classList.remove('approved');
                overlayStamp.classList.add('rejected', 'show');
                overlayStamp.style.background = '#ef4444';
            }
        }

        function overlayHide() {
            overlayLarge.classList.remove('show');
            overlayStamp.classList.remove('show', 'approved', 'rejected');
            setTimeout(() => overlay.style.display = 'none', 350);
        }

        function updateScore() {
            const scoreText = translations[currentLang] ? translations[currentLang]['score'] : 'Score: ';
            scoreEl.textContent = `${scoreText}${score}`;
        }

        function updateStreak() {
            const streakText = translations[currentLang] ? translations[currentLang]['streak'] : 'Streak: ';
            streakEl.textContent = `${streakText}${streak}`;
            streakCountDisplay.textContent = streak;
            if (streak >= 3) streakCounter.style.display = 'block';
            else streakCounter.style.display = 'none';
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 300;
            updateTimer();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimer();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    finishLevel();
                }
            }, 1000);
        }

        function updateTimer() {
            const m = Math.floor(timeLeft / 60);
            const s = timeLeft % 60;
            const timerLabel = translations[currentLang]?.['timer-label'] || 'Time';
            timeEl.textContent = `${timerLabel}: ${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
        }

        /* ---- SERVER COMMUNICATION ---- */
        async function saveGameResult(userId, gameScore) {
            try {
                const timeTaken = 300 - timeLeft; // in seconds
               
                const response = await fetch('/api/game/save-result-with-rank', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: userId,
                        gameName: gameName,
                        score: gameScore,
                        timeTaken: timeTaken,
                        completed: true
                    })
                });
               
                if (!response.ok) {
                    throw new Error('Failed to save game result');
                }
               
                return await response.json();
            } catch (error) {
                console.error('Error saving game result:', error);
                throw error;
            }
        }

        async function getGameLeaderboard(gameName) {
            try {
                const response = await fetch(`/api/game/leaderboard/${encodeURIComponent(gameName)}`);
               
                if (!response.ok) {
                    throw new Error('Failed to fetch leaderboard');
                }
               
                return await response.json();
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                return [];
            }
        }

        /* ---- DISPLAY FINAL RESULTS ---- */
        function displayFinalResults(finalScore, rank, leaderboardData) {
            // Update score and rank display
            finalScoreElement.textContent = finalScore;
            finalRankElement.textContent = rank;
           
            // Add proper suffix to rank
            const suffix = getRankSuffix(rank);
            rankSuffixElement.textContent = suffix;
           
            // Display leaderboard
            if (leaderboardData && leaderboardData.length > 0) {
                displayLeaderboard(leaderboardData);
                leaderboardPreview.style.display = 'block';
            } else {
                leaderboardPreview.style.display = 'none';
            }
           
            // Add celebration effects based on rank
            if (rank <= 3) {
                celebrateTopRank(rank);
            }
        }

        function getRankSuffix(rank) {
            if (rank % 100 >= 11 && rank % 100 <= 13) {
                return 'th';
            }
            switch (rank % 10) {
                case 1: return 'st';
                case 2: return 'nd';
                case 3: return 'rd';
                default: return 'th';
            }
        }

        function displayLeaderboard(leaderboardData) {
            leaderboardList.innerHTML = '';
           
            const user = JSON.parse(localStorage.getItem('user'));
            const currentUserId = user ? user.id : null;
           
            // Sort by score descending
            leaderboardData.sort((a, b) => b.score - a.score);
           
            // Display top 5 or less
            const displayCount = Math.min(5, leaderboardData.length);
            for (let i = 0; i < displayCount; i++) {
                const player = leaderboardData[i];
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
               
                // Highlight current user
                if (player.user_id == currentUserId) {
                    item.classList.add('current-user');
                }
               
                // Format rank (starting from 1)
                const rank = i + 1;
                const rankSuffix = getRankSuffix(rank);
               
                item.innerHTML = `
                    <div class="leaderboard-rank">${rank}${rankSuffix}</div>
                    <div class="leaderboard-name">${player.fullName}</div>
                    <div class="leaderboard-score">${player.score}</div>
                `;
               
                leaderboardList.appendChild(item);
            }
        }

        function celebrateTopRank(rank) {
            // Add special effects for top 3 ranks
            const medalColors = ['#FFD700', '#C0C0C0', '#CD7F32']; // Gold, Silver, Bronze
           
            if (rank <= 3) {
                // Update medal icon color
                const medalIcon = document.querySelector('.level-complete .badge i');
                medalIcon.style.color = medalColors[rank - 1];
               
                // Add special confetti for top ranks
                createSpecialConfetti(rank);
               
                // Play victory sound if available
                if (rank === 1) {
                    // First place special celebration
                    setTimeout(() => {
                        createConfetti();
                        setTimeout(() => createConfetti(), 300);
                        setTimeout(() => createConfetti(), 600);
                    }, 500);
                }
            }
        }

        function createSpecialConfetti(rank) {
            const colors = rank === 1 ? ['#FFD700', '#FFED4E', '#FFF9C4'] :
                          rank === 2 ? ['#C0C0C0', '#E5E4E2', '#D3D3D3'] :
                          ['#CD7F32', '#B87333', '#8B4513'];
           
            for (let i = 0; i < 15; i++) {
                const c = document.createElement('div');
                c.style.position = 'fixed';
                c.style.left = Math.random() * 100 + 'vw';
                c.style.top = '-10px';
                c.style.width = '12px';
                c.style.height = '12px';
                c.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                c.style.zIndex = 1500;
                c.style.borderRadius = '50%';
                c.style.animation = `confetti-fall ${2 + Math.random()}s ease-out forwards`;
                document.body.appendChild(c);
                setTimeout(() => { if (document.body.contains(c)) document.body.removeChild(c); }, 3000);
            }
        }

        function createConfetti() {
            for (let i=0;i<12;i++){
                const c = document.createElement('div');
                c.style.position='fixed';
                c.style.left = Math.random()*100 + 'vw';
                c.style.top = '-10px';
                c.style.width='10px'; c.style.height='10px';
                const colors = ['#ff6b6b','#4ecdc4','#45b7d1','#96ceb4','#ffeaa7'];
                c.style.backgroundColor = colors[Math.floor(Math.random()*colors.length)];
                c.style.zIndex = 1500;
                c.style.borderRadius = '2px';
                c.style.animation = `confetti-fall 2.8s ease-out forwards`;
                document.body.appendChild(c);
                setTimeout(()=> { if (document.body.contains(c)) document.body.removeChild(c); }, 3000);
            }
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', function() {
            // The authentication check happens at the beginning of the script
            // The init() function is called after authentication check
        });
    </script>
</body>
</html>